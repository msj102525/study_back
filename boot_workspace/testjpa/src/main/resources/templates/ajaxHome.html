<!DOCTYPE xmlns:th="http://www.thymeleaf.org">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        div#listarea{
            float:left;
        }
        div#inputarea{
            width: 400px;
            height: 300px;
            border: 1px solid darkred;
            margin-left: 400px;
        }
    </style>
    <script type="text/javascript" src="/js/jquery-3.7.1.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            //board 테이블의 전체 목록 조회 출력
            $.ajax({
                url: "/boards",
                type: "get",
                dataType: "json",
                success: function(data){
                    //object --> string
                    var str = JSON.stringify(data);
                    // alert(str)

                    //string --> json
                    var json = JSON.parse(str);

                    values = "";
                    for(var i in json){
                        values +=
                            "<tr><td>" + json[i].boardNum
                            + "</td><td><a id='read_'" + json[i].boardNum + "'>" + json[i].boardTitle + "</a></td><td>"
                            + json[i].boardWriter + "</td></tr>";
                    }

                    $('#toplist').html($('#toplist').html() + values);
                    //$('#toplist').append(values);
                },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                }
            });  //ajax  목록 조회
            // 등록 버튼 클릭하면, input 의 값들을 읽어와서, json 객체 만들어서 서버로 요청
            $('#registerBtn').on('click', function (){
                // 값을 입력 받은 input 태그에 접근
                var inputBtitle = $('#btitle');
                var inputBwriter = $('#bwriter');
                var inputBcontent = $('#bcontent');

                // 각 input 태그에 기록된 값 추출
                var titleValue = inputBtitle.val()
                var writerValue = inputBwriter.val()
                var contentValue = inputBcontent.val()

                // 전송할 json 객체 만들기
                var boardObject = {
                    boardTitle : titleValue,
                    boardWriter : writerValue,
                    boardContent : contentValue
                };

                $.ajax({
                    type : "post",
                    url : "/boards",
                    data : JSON.stringify(boardObject),
                    contentType : "application/json; charset=UTF-8",
                    success: function (){
                        // 페이지 새로 고침
                        window.location.reload(true);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }
                });   // 글 등록 ajax
            }); // 글 등록 버튼 click

            $('#readBtn').on('click', function (){
                var boardNumValue = $('#bnum').val()

                $.ajax({
                    type : "get",
                    url : "boards/" + boardNumValue,
                    contentType : "application/json; charset=UTF-8",
                    success: function (data){
                        $('#btitle').val(data.boardTitle);
                        $('#bwriter').val(data.boardWriter);
                        $('#bcontent').val(data.boardContent)
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }
                }); // 글 조회 ajax

            });   // 조회 버튼 click

            $('#deleteBtn').on('click', function(){
                var boardNumValue = $('#bnum').val()

                $.ajax({
                    type:'delete',
                    url: "boards/" + boardNumValue,
                    contentType : "application/json; charset=UTF-8",
                    success: function (){
                        window.location.reload(true)
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }
                });

            })// 글 삭제 버튼 click

            $('#modifyBtn').on('click', function (){
                var boardNumValue = $('#bnum').val()
                var titleVal = $('#btitle').val()
                var contentVal = $('#bcontent').val()

                // 전송 json 만들기
                var boardObject = {
                    boardNum : boardNumValue,
                    boardTitle: titleVal,
                    boardContent: contentVal,

                }

                $.ajax({
                    type:'put',
                    url:"/boards/" + boardNumValue, // put 전송시에는 반드시 url 뒤에 pathVariable 필요
                    // pathvariable 에 대한 값이 없으면, 자동 post 로 전송
                    data: JSON.stringify(boardObject),
                    contentType : "application/json; charset=UTF-8",
                    success: function (){
                        window.location.reload(true)
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log("error : " + jqXHR + ", " + textStatus + ", " + errorThrown);
                    }

                });


            })  // 글 수정 버튼 click

        })// document.ready
    </script>
</head>
<body>
<h1>Spring Boot JPA Test : jpa only</h1>
<hr>
<div id="listarea">
    <table id="toplist">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
        </tr>
    </table>
</div>
<div id="inputarea">
    <table>
        <tr>
            <td><label for="bnum">번호</label></td>
            <td><input type="text" name="boardNum" id="bnum" value=""></td>
        </tr>
        <tr>
            <th><label for="btitle">제목</label></th>
            <td><input type="text" name="boardNum" id="btitle" value=""></td>
        </tr>
        <tr>
            <th><label for="bwriter">작성자</label></th>
            <td><input type="text" name="boardNum" id="bwriter" value=""></td>
        </tr>
        <tr>
            <td><label for="bcontent">내용</label></td>
            <td><textarea name="boardNum" id="bcontent"></textarea></td>
        </tr>
    </table>
    <hr>
    <button id="registerBtn">등록</button> &nbsp;
    <button id="readBtn">조회</button>  &nbsp;
    <button id="modifyBtn">수정</button>  &nbsp;
    <button id="deleteBtn">삭제</button>
</div>
</body>
</html>